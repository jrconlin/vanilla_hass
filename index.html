<!DOCTYPE html>
<html>
    <head>
        <title>Home Assistant Vanilla</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <link type="text/css" rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="banner" id="header">
        <h1>Vanilla Home Assistant</h1>
        <h2>Old school in the 21th Century</h2>
        </div>
        <div id="config">
            <div class="item"><label for="site">Site:</label><input
                    type="text" name="site" placeholder="home.lan.unitedheroes.net" value="home.lan.unitedheroes.net"
            ></div>
            <div class="control"><button name="save_conf">Save</button></div>
        </div>
        <div class="body">
            <div id="pages"></div>
            <div id="elements"></div>
        </div>
    <script src="worker.js"></script>
    <script src="socket.js"></script>
    <script>
    window.ws = new Connection();
    window.ws.connect().then(conn => {
        conn.send('get_states',
            function(states) {
            // Populate the sensors
                for (let element of states.result) {
                    if (element == undefined) {
                        continue;
                    }
                    let grouping = sensor_type(element);
                    let gtype = grouping[0];
                    let elements = document.getElementById("elements");
                    let group = elements.getElementsByClassName(gtype)[0];
                    if (group === undefined){
                        group = document.createElement('div');
                        let heading = document.createElement('h2');
                        heading.innerText = gtype;
                        group.appendChild(heading);
                        group.classList.add(gtype);
                        elements.appendChild(group);
                    }
                    try {
                        window["make_"+gtype](element, grouping, group)
                    } catch(e) {
                        make_sensor(element, grouping, group)
                    }
                }
            })
    });
    </script>
    </body>
</html>
